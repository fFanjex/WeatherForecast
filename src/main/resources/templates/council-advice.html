<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>WeatherForecast ‚Ä¢ –°–æ–≤–µ—Ç –ø–æ –æ–¥–µ–∂–¥–µ</title>
    <link rel="stylesheet" type="text/css" href="/advice.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<div class="bg"></div>
<div class="noise"></div>

<header class="header">
    <div class="container header-inner">
        <a href="/view-weather" class="chip">
            <span class="chip-ico">‚¨ÖÔ∏è</span>
            <span>–ù–∞–∑–∞–¥</span>
        </a>

        <div class="brand">
            <div class="logo" aria-hidden="true">WF</div>
            <div class="brand-text">
                <div class="brand-title" id="animated-title">
                    <span>W</span><span>e</span><span>a</span><span>t</span><span>h</span><span>e</span><span>r</span>
                    <span>F</span><span>o</span><span>r</span><span>e</span><span>c</span><span>a</span><span>s</span><span>t</span>
                </div>
                <div class="brand-subtitle">–°–æ–≤–µ—Ç –ø–æ –æ–¥–µ–∂–¥–µ</div>
            </div>
        </div>

        <form th:action="@{/logout}" method="post" class="logout-form">
            <button type="submit" class="chip danger">
                <span class="chip-ico">üö™</span>
                <span>–í—ã–π—Ç–∏</span>
            </button>
        </form>
    </div>
</header>

<main class="main">
    <div class="container grid">
        <section class="card hero">
            <div class="hero-head">
                <div class="badge">ü•º Advice</div>
                <div>
                    <h1 class="hero-title">–ö–∞–∫ –ª—É—á—à–µ –æ–¥–µ—Ç—å—Å—è</h1>
                    <p class="hero-subtitle">–°–æ–≤–µ—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ, –≤–ª–∞–∂–Ω–æ—Å—Ç–∏ –∏ –≤–µ—Ç—Ä—É.</p>
                </div>
            </div>

            <div class="advice-box">
                <p class="advice-text" th:text="${advice}">–ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å–æ–≤–µ—Ç</p>
            </div>

            <div class="actions">
                <a href="/view-weather" class="btn ghost">
                    <span class="btn-ico">‚¨ÖÔ∏è</span>
                    <span>–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</span>
                </a>
                <button id="save-advice-btn" class="btn primary" type="button">
                    <span class="btn-ico">üíæ</span>
                    <span>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≤–µ—Ç</span>
                </button>
            </div>

            <div id="toast" class="toast" role="status" aria-live="polite">
                <div class="toast-title" id="toast-title">–ì–æ—Ç–æ–≤–æ</div>
                <div class="toast-text" id="toast-text">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ</div>
            </div>
        </section>

        <section class="card side">
            <h2 class="side-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>

            <div class="tiles">
                <a href="/home" class="tile">
                    <div class="tile-icon">üè†</div>
                    <div class="tile-text">
                        <div class="tile-title">–ì–ª–∞–≤–Ω–∞—è</div>
                        <div class="tile-desc">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é</div>
                    </div>
                    <div class="tile-cta">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</div>
                </a>

                <a href="/view-weather" class="tile">
                    <div class="tile-icon">üå§</div>
                    <div class="tile-text">
                        <div class="tile-title">–ü–æ–≥–æ–¥–∞</div>
                        <div class="tile-desc">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—Ä—É–≥–æ–π –≥–æ—Ä–æ–¥</div>
                    </div>
                    <div class="tile-cta">–û—Ç–∫—Ä—ã—Ç—å ‚Üí</div>
                </a>

                <form th:action="@{/logout}" method="post" class="tile-form">
                    <button type="submit" class="tile danger">
                        <div class="tile-icon">üö™</div>
                        <div class="tile-text">
                            <div class="tile-title">–í—ã—Ö–æ–¥</div>
                            <div class="tile-desc">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é</div>
                        </div>
                        <div class="tile-cta">–í—ã–π—Ç–∏ ‚Üí</div>
                    </button>
                </form>
            </div>

            <div class="mini">
                <div class="mini-card">
                    <div class="mini-num">ü•∂</div>
                    <div class="mini-text">—Ö–æ–ª–æ–¥–Ω–æ</div>
                </div>
                <div class="mini-card">
                    <div class="mini-num">üå¶</div>
                    <div class="mini-text">–ø–µ—Ä–µ–º–µ–Ω–Ω–æ</div>
                </div>
                <div class="mini-card">
                    <div class="mini-num">‚òÄÔ∏è</div>
                    <div class="mini-text">—Ç–µ–ø–ª–æ</div>
                </div>
            </div>
        </section>
    </div>
</main>

<footer class="footer">
    <div class="container footer-inner">
        <p>¬© 2025 Weather Forecast ‚Ä¢ –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
        <p class="footer-muted">Made with ‚òÅÔ∏è &amp; ‚òÄÔ∏è</p>
    </div>
</footer>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const titleSpans = document.querySelectorAll('#animated-title span');
        titleSpans.forEach((span, idx) => {
            span.style.opacity = '0';
            span.style.transition = 'opacity 0.4s ease';
            setTimeout(() => span.style.opacity = '1', idx * 70);
        });
    });

    const toast = document.getElementById('toast');
    const toastTitle = document.getElementById('toast-title');
    const toastText = document.getElementById('toast-text');

    const showToast = (title, text, ok=true) => {
        toastTitle.textContent = title;
        toastText.textContent = text;
        toast.classList.remove('show');
        toast.classList.remove('bad');
        if(!ok) toast.classList.add('bad');
        requestAnimationFrame(() => toast.classList.add('show'));
        clearTimeout(window.__toastT);
        window.__toastT = setTimeout(() => toast.classList.remove('show'), 2600);
    };

    $(document).ready(function() {
        $("#save-advice-btn").click(function() {
            let adviceText = $(".advice-text").text();

            $.ajax({
                url: "/api/advice/save",
                type: "POST",
                data: { adviceText: adviceText },
                success: function(response) {
                    showToast("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚úÖ", String(response || "–°–æ–≤–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω"));
                },
                error: function(xhr) {
                    showToast("–û—à–∏–±–∫–∞ ‚ùå", String(xhr.responseText || "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å"), false);
                }
            });
        });
    });
</script>
</body>
</html>